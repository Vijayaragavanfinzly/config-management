<div class="">
    <div class="compare-container">
        <div class="compare-cards">
            <div class="tenant-card">


                <!-- First Environment Select -->
                <mat-form-field appearance="outline" class="search-select">
                    <mat-label>Select Environment 1</mat-label>
                    <mat-select [(ngModel)]="selectedEnv1" panelClass="custom-select-panel" required>
                        <mat-option>
                            <ngx-mat-select-search [formControl]="searchInput" placeholderLabel="Search..."
                                noEntriesFoundLabel="No options found"></ngx-mat-select-search>
                        </mat-option>
                        <mat-option *ngFor="let option of environments" [value]="option">
                            {{ option | uppercase }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>


                <!-- Second Environment Select -->
                <mat-form-field appearance="outline" class="search-select">
                    <mat-label>Select Environment 2</mat-label>
                    <mat-select [(ngModel)]="selectedEnv2" panelClass="custom-select-panel" required>
                        <mat-option>
                            <ngx-mat-select-search [formControl]="searchInput" placeholderLabel="Search..."
                                noEntriesFoundLabel="No options found"></ngx-mat-select-search>
                        </mat-option>
                        <mat-option *ngFor="let option of environments" [value]="option">
                            {{ option | uppercase }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

            </div>
            <div class="action-buttons">
                <button class="btn-primary" id="compareButton" (click)="compareEnvironments()">
                    <i class="fas fa-bolt"></i> Compare
                </button>
                <button class="btn-secondary" id="clearButton" (click)="clearSelections()">
                    <i class="fas fa-eraser"></i> Clear
                </button>
            </div>
        </div>
        <div *ngIf="tenantsOfEnv1.length > 0 || tenantsOfEnv2.length > 0" class="available-tenants">
            <span *ngIf="tenantsOfEnv1.length > 0" class="tenants-inline">
                <strong>Tenants in {{ selectedEnv1 | uppercase }}:</strong>
                {{ tenantsOfEnv1.join(', ').toUpperCase() }}
            </span>
            <div class="divider"></div>
            <span *ngIf="tenantsOfEnv2.length > 0" class="tenants-inline">
                <strong>Tenants in {{ selectedEnv2 | uppercase }}:</strong>
                {{ tenantsOfEnv2.join(', ').toUpperCase() }}
            </span>
        </div>

    </div>
</div>
<!--  -->




<div *ngIf="loading" class="spinner-container">
    <app-spinner></app-spinner>
</div>

<div *ngIf="!loading && (CommonProperties.length > 0 || TenantBasedProperties.length > 0)" class="mt-5 search-bar">
    <div class="form-control search-input-container">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="form-control search-input" [(ngModel)]="searchQuery"
            (input)="handleSearchQueryChange()" placeholder="Search ..." />
    </div>
</div>


<div class="tab-row">
    <div class="tab-bar"
        *ngIf="filteredCommonMatchingProperties.length > 0 || filteredCommonNonMaatchingProperties.length > 0 || filteredTenantMatchingProperties.length > 0 || filteredTenantNonMatchingProperties.length > 0">
        <div class="tab active" [ngClass]="{'active': activeTab === 'tenant'}" (click)="setActiveTab('tenant')">
            <i class="fa-solid fa-building"></i>
            <span>Tenant Properties</span>
            <span class="badge">{{ tenantBasedSized }}</span>
        </div>

        <div class="tab" [ngClass]="{'active': activeTab === 'common'}" (click)="setActiveTab('common')">
            <i class="fa-solid fa-layer-group"></i>
            <span>Common Properties</span>
            <span class="badge">{{ nonTenantBasedSize }}</span>
        </div>
    </div>


    <div class="dropdown-container"
        *ngIf="filteredCommonMatchingProperties.length > 0 || filteredCommonNonMaatchingProperties.length > 0 || filteredTenantMatchingProperties.length > 0 || filteredTenantNonMatchingProperties.length > 0">
        <div class="dropdown">
            <button class="dropdown-toggle1 ps-2 d-flex justify-content-around align-items-center"
                (click)="toggleDropdown()">
                {{ selectedFilter }}
                <span class="badge3">{{ getActiveTabCount() }}</span>
                <i class="fa-solid fa-chevron-down" [ngClass]="{'rotated': showDropdown}"></i>
            </button>
            <div class="dropdown-menu" [class.show]="showDropdown">
                <ng-container *ngIf="activeTab === 'tenant'">
                    <div class="dropdown-item" (click)="selectFilter('Matching')">
                        <i class="fa-solid fa-check"></i>
                        <span>Matching</span>
                        <span class="badge2">{{ tenantPropertySameSize }}</span>
                    </div>
                    <div class="dropdown-item" (click)="selectFilter('Non-Matching')">
                        <i class="fa-solid fa-times"></i>
                        <span>Non-Matching</span>
                        <span class="badge2">{{ tenantPropertyDifferentSize }}</span>
                    </div>
                </ng-container>
                <ng-container *ngIf="activeTab === 'common'">
                    <div class="dropdown-item" (click)="selectFilter('Matching')">
                        <i class="fa-solid fa-check"></i>
                        <span>Matching</span>
                        <span class="badge2">{{ nonTenantPropertySameSize }}</span>
                    </div>
                    <div class="dropdown-item" (click)="selectFilter('Non-Matching')">
                        <i class="fa-solid fa-times"></i>
                        <span>Non-Matching</span>
                        <span class="badge2">{{ nonTenantPropertyDifferentSize }}</span>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>

</div>


<div *ngIf="filteredCommonMatchingProperties.length > 0 && activeTab === 'common' && selectedFilter === 'Matching' "
    class="table-responsive">
    <div class="table-responsive table-container">


        <table class="table custom-table shadow-sm">
            <thead>
                <tr>
                    <th *ngFor="let column of commonPropertiesColumns; let i = index"
                        [ngStyle]="{'width': column.width + 'px', 'max-width': column.width + 'px'}"
                        class="text-center position-relative">
                        {{ column.name }}

                        <div class="resize-handle" (mousedown)="onMouseDown($event, i, 'common')"></div>
                    </th>
                </tr>
            </thead>
            <tbody class="table-body">
                <tr *ngFor="let entry of paginatedSameData">
                    <td class="" [matTooltip]="entry.propertyKey" matTooltipShowDelay="300" matTooltipPosition="above"
                        [innerHTML]="highlightText(entry.propertyKey || '-', searchQuery)">
                    </td>
                    <td class="" [matTooltip]="entry.PropertyValue1" matTooltipShowDelay="300"
                        matTooltipPosition="above" matTooltipClass="custom-tooltip"
                        [innerHTML]="highlightText(entry.env1Value !== '' ? entry.env1Value : '-', searchQuery)"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="pagination-container d-flex justify-content-between align-items-center mt-3 mb-3">
        <div class="total-records">
            Total Records: <strong>{{sizeOfCommonMatching}}</strong>
        </div>

        <div class="pagination-controls d-flex align-items-center">
            <span class="pagination-nav" [class.disabled]="currentPage === 1" (click)="goToPreviousPage()">
                <i class="fas fa-angle-double-left"></i>
            </span>
            <ng-container *ngFor="let page of pages">
                <span *ngIf="page !== -1" class="pagination-page" [class.active]="page === currentPage"
                    (click)="goToPage(page)">
                    {{ page }}
                </span>
                <span *ngIf="page === -1" class="pagination-dots">...</span>
            </ng-container>
            <span class="pagination-nav" [class.disabled]="currentPage === totalPages" (click)="goToNextPage()">
                <i class="fas fa-angle-double-right"></i>
            </span>
        </div>

        <!-- Items Per Page Dropdown -->
        <div class="items-per-page">
            <div for="pageSize" class="me-2 total-records">Items per page:</div>
            <select id="pageSize" class="form-select d-inline-block w-auto" [(ngModel)]="pageSize"
                (change)="updatePagination()">
                <option [value]="10">10</option>
                <option [value]="20">20</option>
                <option [value]="50">50</option>
                <option [value]="100">100</option>
            </select>
        </div>
    </div>
</div>


<div *ngIf="filteredCommonNonMaatchingProperties.length > 0 && activeTab === 'common' && selectedFilter === 'Non-Matching' "
    class="table-responsive">
    <div class="table-container table-responsive">


        <table class="table custom-table shadow-sm">
            <thead>
                <tr>
                    <th *ngFor="let column of commonPropertiesColumns_different; let i = index"
                        [ngStyle]="{'width': column.width + 'px', 'max-width': column.width + 'px'}"
                        class="text-center position-relative">
                        <span *ngIf="column.name === 'Property Value 1'">
                            {{ selectedEnv1 }}
                        </span>
                        <span *ngIf="column.name === 'Property Value 2'">
                            {{ selectedEnv2 }}
                        </span>
                        <span *ngIf="column.name !== 'Property Value 1' && column.name !== 'Property Value 2'">
                            {{ column.name }}
                        </span>

                        <div class="resize-handle" (mousedown)="onMouseDown($event, i, 'common_different')">
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody class="table-body">
                <tr *ngFor="let entry of paginatedDifferentData">
                    <td class="" [matTooltip]="entry.propertyKey" matTooltipShowDelay="300" matTooltipPosition="above"
                        matTooltipClass="custom-tooltip"
                        [innerHTML]="highlightText(entry.propertyKey || '-', searchQuery)">
                    </td>
                    <td class="" [matTooltip]="entry.PropertyValue1" matTooltipShowDelay="300"
                        matTooltipPosition="above" matTooltipClass="custom-tooltip"
                        [innerHTML]="highlightText(entry.env1Value || '-', searchQuery)"></td>
                    <td class="text-center">
                        <i class="fas fa-pencil-alt action-icon me-2" title="Edit Value 1"
                            (click)="editProperty(entry, 'env_value1')" style="color: #28a745;"></i>
                        <i class="fas fa-arrow-circle-right action-icon me-2" title="Copy Value 1 to Tenant 2" (click)="openConfirmationDialog(
                            selectedTenant2,
                            selectedEnv2,
                            entry.value1,
                            entry.propertyKey2
                          )" style="color: red;"></i>

                        <i class="fas fa-arrow-circle-left action-icon me-2" title="Copy Value 2 to Tenant 1" (click)="openConfirmationDialog(
                            selectedTenant1,
                            selectedEnv1,
                            entry.value2,
                            entry.propertyKey1
                          )" style="color: red;"></i>
                        <i class="fas fa-pencil-alt action-icon me-2" title="Edit Value 2"
                            (click)="editProperty(entry, 'env_value2')" style="color: #28a745;"></i>
                        <!-- <i class="fas fa-copy action-icon" title="Copy" (click)="copyToClipboard(entry.env_value2)"
                                    style="color: #6c757d;">
                                </i> -->
                    </td>
                    <td class="" [matTooltip]="entry.PropertyValue2" matTooltipShowDelay="300"
                        matTooltipPosition="above" matTooltipClass="custom-tooltip"
                        [innerHTML]="highlightText(entry.env2Value || '-', searchQuery)"></td>
                    <!-- <td class="text-center">
                                <i class="fas fa-copy action-icon" title="Copy"
                                    (click)="copyToClipboard(entry.value_env2)" style="color: #6c757d;">
                                </i>
                            </td> -->
                </tr>
            </tbody>
        </table>
    </div>
    <div class="pagination-container d-flex justify-content-between align-items-center mt-3 mb-3">
        <div class="total-records">
            Total Records: <strong>{{sizeOfCommonNonMatching}}</strong>
        </div>

        <div class="pagination-controls d-flex align-items-center">
            <span class="pagination-nav" [class.disabled]="currentPage === 1" (click)="goToPreviousPage()">
                <i class="fas fa-angle-double-left"></i>
            </span>
            <ng-container *ngFor="let page of pages">
                <span *ngIf="page !== -1" class="pagination-page" [class.active]="page === currentPage"
                    (click)="goToPage(page)">
                    {{ page }}
                </span>
                <span *ngIf="page === -1" class="pagination-dots">...</span>
            </ng-container>
            <span class="pagination-nav" [class.disabled]="currentPage === totalPages" (click)="goToNextPage()">
                <i class="fas fa-angle-double-right"></i>
            </span>
        </div>

        <div class="items-per-page">
            <div for="pageSize" class="me-2 total-records">Items per page:</div>
            <select id="pageSize" class="form-select d-inline-block w-auto" [(ngModel)]="pageSize"
                (change)="updatePagination()">
                <option [value]="10">10</option>
                <option [value]="20">20</option>
                <option [value]="50">50</option>
                <option [value]="100">100</option>
            </select>
        </div>
    </div>
</div>

<div *ngIf="filteredTenantMatchingProperties.length > 0 && activeTab === 'tenant' && selectedFilter === 'Matching'"
    class="table-responsive">
    <div class="table-responsive table-container">


        <table class="table custom-table shadow-sm">
            <thead>
                <tr>
                    <th *ngFor="let column of tenantPropertiesColumn_same; let i = index"
                        [ngStyle]="{'width': column.width + 'px', 'max-width': column.width + 'px'}"
                        class="text-center position-relative">
                        <span *ngIf="column.name === 'Property Key 1'">
                            {{ selectedTenant1 + " - " + selectedEnv1 + " Key"}}
                        </span>
                        <span *ngIf="column.name === 'Property Key 2'">
                            {{ selectedTenant2 + " - " + selectedEnv2 + " Key"}}
                        </span>
                        <span *ngIf="column.name !== 'Property Key 1' && column.name !== 'Property Key 2'">
                            {{ column.name }}
                        </span>

                        <div class="resize-handle" (mousedown)="onMouseDown($event, i, 'tenant_same')"></div>
                    </th>
                </tr>
            </thead>
            <tbody class="table-body">
                <tr *ngFor="let entry of paginatedTenantSameProperties">
                    <td class="" [innerHTML]="highlightText(entry.propertykey || '-', searchQuery)"></td>
                    <!-- <td class="">{{ entry.propertyKey1 !== '' ? entry.propertyKey1 : '-' }}</td>
                  <td class="">{{ entry.propertyKey2 !== '' ? entry.propertyKey2 : '-' }}</td> -->
                    <td class="" [innerHTML]="highlightText(getFirstTenantValue(entry) || '-', searchQuery)"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="pagination-container d-flex justify-content-between align-items-center mt-3 mb-3">
        <div class="total-records">
            Total Records: <strong>{{sizeOfTenantMatching}}</strong>
        </div>

        <div class="pagination-controls d-flex align-items-center">
            <span class="pagination-nav" [class.disabled]="currentPage === 1" (click)="goToPreviousPage()">
                <i class="fas fa-angle-double-left"></i>
            </span>
            <ng-container *ngFor="let page of pages">
                <span *ngIf="page !== -1" class="pagination-page" [class.active]="page === currentPage"
                    (click)="goToPage(page)">
                    {{ page }}
                </span>
                <span *ngIf="page === -1" class="pagination-dots">...</span>
            </ng-container>
            <span class="pagination-nav" [class.disabled]="currentPage === totalPages" (click)="goToNextPage()">
                <i class="fas fa-angle-double-right"></i>
            </span>
        </div>

        <div class="items-per-page">
            <div for="pageSize" class="me-2 total-records">Items per page:</div>
            <select id="pageSize" class="form-select d-inline-block w-auto" [(ngModel)]="pageSize"
                (change)="updatePagination()">
                <option [value]="10">10</option>
                <option [value]="20">20</option>
                <option [value]="50">50</option>
                <option [value]="100">100</option>
            </select>
        </div>
    </div>
</div>

<div *ngIf="filteredTenantNonMatchingProperties.length > 0 && activeTab == 'tenant' && selectedFilter == 'Non-Matching' "
    class="table-responsive">
    <div class="table-container table-responsive">


        <table class="table custom-table shadow-sm">
            <thead>
                <tr>
                    <th *ngFor="let column of differentColumns; let i = index"
                        [ngStyle]="{'width': column.width + 'px', 'max-width': column.width + 'px'}"
                        class="text-center position-relative">
                        <span *ngIf="column.name === 'Tenant 1 Value'">
                            {{ selectedEnv1 }}
                        </span>
                        <span *ngIf="column.name === 'Tenant 2 Value'">
                            {{ selectedEnv2 }}
                        </span>
                        <span *ngIf="column.name !== 'Tenant 1 Value' && column.name !== 'Tenant 2 Value'">
                            {{ column.name }}
                        </span>

                        <div class="resize-handle" (mousedown)="onMouseDown($event, i, 'different')"></div>
                    </th>
                </tr>
            </thead>
            <tbody class="table-body">
                <tr *ngFor="let entry of paginatedTenantDifferentProperties">
                    <td class="" [innerHTML]="highlightText(entry.propertykey || '-', searchQuery)"></td>
                    <td *ngFor="let column of differentColumns.slice(1, -1); let i = index" [ngClass]="{
        'env1-column': column.group === 'env1',
        'env2-column': column.group === 'env2',
        'not-available': entry[column.field] === 'not available',
        'text-center': entry[column.field] === 'not available' || entry[column.field] === 'DEVOPS_INPUT' || entry[column.field] === 'OPS_INPUT',
        'devops-input': entry[column.field] === 'DEVOPS_INPUT',
        'ops-input': entry[column.field] === 'OPS_INPUT'
    }" (contextmenu)="onRightClick($event, entry, column)">

                        <span [ngClass]="{
            'not-available-inside': entry[column.field] === 'not available',
            'devops-input-inside': entry[column.field] === 'DEVOPS_INPUT',
            'ops-input-inside': entry[column.field] === 'OPS_INPUT'
        }" [innerHTML]="highlightText(
            entry[column.field] === 'not available' ? 'MISSING KEY' : entry[column.field] || '-',
            searchQuery)">
                        </span>
                    </td>

                    <td class="text-center ellipse-btn">
                        <i class="fas fa-ellipsis-h" title="Action" (click)="openDialog(entry)"></i>
                    </td>
                </tr>
            </tbody>
        </table>
        <div *ngIf="showContextMenu" class="context-menu" [style.left.px]="menuPosition.x"
            [style.top.px]="menuPosition.y">
            <ul>
                <li (click)="editEntry()" data-tooltip="Edit this property">
                    <i class="fas fa-edit"></i> Edit
                </li>
                <li (click)="swapEntry()" data-tooltip="Swap values between tenants">
                    <i class="fas fa-exchange-alt"></i> Swap
                </li>
                <li (click)="copyEntry()" data-tooltip="Copy the property value">
                    <i class="fas fa-copy"></i> Copy
                </li>
            </ul>
        </div>
    </div>
    <div class="pagination-container d-flex justify-content-between align-items-center mt-3 mb-3">
        <div class="total-records">
            Total Records: <strong>{{sizeOfTenantNonMatching}}</strong>
        </div>

        <div class="pagination-controls d-flex align-items-center">
            <span class="pagination-nav" [class.disabled]="currentPage === 1" (click)="goToPreviousPage()">
                <i class="fas fa-angle-double-left"></i>
            </span>
            <ng-container *ngFor="let page of pages">
                <span *ngIf="page !== -1" class="pagination-page" [class.active]="page === currentPage"
                    (click)="goToPage(page)">
                    {{ page }}
                </span>
                <span *ngIf="page === -1" class="pagination-dots">...</span>
            </ng-container>
            <span class="pagination-nav" [class.disabled]="currentPage === totalPages" (click)="goToNextPage()">
                <i class="fas fa-angle-double-right"></i>
            </span>
        </div>

        <div class="items-per-page">
            <div for="pageSize" class="me-2 total-records">Items per page:</div>
            <select id="pageSize" class="form-select d-inline-block w-auto" [(ngModel)]="pageSize"
                (change)="updatePagination()">
                <option [value]="10">10</option>
                <option [value]="20">20</option>
                <option [value]="50">50</option>
                <option [value]="100">100</option>
            </select>
        </div>
    </div>
</div>


<div *ngIf="!loading && searchQuery && filteredCommonMatchingProperties.length == 0  && filteredCommonNonMaatchingProperties.length === 0 && filteredTenantMatchingProperties.length === 0 && filteredTenantNonMatchingProperties.length === 0"
    class="no-results">
    <div class="no-results-content text-center">
        <i class="fas fa-search fa-3x"></i>
        <h4 class="mt-3">No Results Found</h4>
        <p class="text-muted">
            We couldnâ€™t find anything matching "<span class="highlight">{{ searchQuery }}</span>".
        </p>
        <button class="btn btn-primary btn-try-again" (click)="clearSearch()">Try Again</button>
    </div>
</div>
<div class="hint-overlay" *ngIf="showOverlayHint">
    <div class="hint-container">
        <div class="hint-content">
            <div class="hint-icon">ðŸ’¡</div>
            <div class="hint-text">
                <strong>Tip:</strong> Right-click on table data to Edit, Swap, or Copy!
            </div>
        </div>
        <button class="hint-button" (click)="hideOverlay()">Got It</button>
    </div>
</div>